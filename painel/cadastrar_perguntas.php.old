<?php include_once "../classes/autoload.php";?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<link rel="stylesheet" href="../css/bootstrap.min.css">
	<script src="../js/jquery-2.1.4.min.js"></script>
	<script src="../js/bootstrap.min.js"></script>
	<link href="../css/bootstrap-toggle.min.css" rel="stylesheet">
<script src="../js/bootstrap-toggle.min.js"></script>
	<link rel="stylesheet" href="../css/painel.css" />
	<title>Gerenciar Perguntas</title>
	<script type="text/javascript">
		$(function(){
			$('.ch').click(function() { 
			    $.post(
			    	"../func/change_status.php",
			    	{id_pergunta: $(this).val()},
			    	function(data){
			    		// if(data == 1){
			    		// 	//alterar para verdadeiro
			    		// 	$(this).prop('checked', true);
			    		// }else{
			    		// 	$(this).prop('checked', false);
			    		// }
			    		console.log(data);
			    	}		
			    );
			});
		// $("#myonoffswitch").click(function(){
		// 	console.log(this.value);
		// });

		});

	</script>

</head>
<body>
		<?php include ("menu.php");?>
	<div class="content-fluid conteudo">
		<div class="row">
			<div class="col-md-12">
				<form action="" method="post">
				<legend>Cadastrar Perguntas</legend>
					<label for="">
						<span>Pergunta</span>
						<input type="text" name="pergunta" />
					</label>
					<div id="pergunta-extra"></div>
					<input type="submit" class="btn btn-default" value="Cadastrar" />
					<input type="hidden" name="acao" value="enviar" />
				</form>
				
				<table width="" class="table  table-bordered tabela">
				</br>
				<?php
				$pdoVar = new PDO("mysql:host=$endereco;dbname=$banco", $usuario, $senha);
				$resultados = $pdoVar->query("SELECT DISTINCT * FROM perguntas");
				while($result = $resultados->fetch(PDO::FETCH_ASSOC)){			
				?>
				<tr>
				<td><a href="editar.php?id_pergunta=<?php echo $result['id'];?>"><?php echo $result['titulo'];?></a></td>
				<td width="20"><a href="?acao=remover&id_pergunta=<?php echo $result['id'];?>"><img src="../icon/gallery_trash1.png"</a></td>
				<td>
					<input data-toggle="toggle" data-on="Ativo" data-off="Inativo" value="<?php echo $result['id']."|".$result['status'];?>" class="ch checkid<?php echo $result['id'];?>" type="checkbox" <?php echo ($result['status'] == 1) ? "checked" : "";?>>
    				</td>
				</tr>
				<?php		
				}

				if(isset($_GET['acao']) && $_GET['acao'] == 'remover'){
      				   $pergunta_id = (isset($_GET['id_pergunta'])) ? $_GET['id_pergunta'] : null;

				$pdoVar = new PDO("mysql:host=$endereco;dbname=$banco", $usuario, $senha);
				$pergunta = new Pergunta("", "", $pdoVar);
				if($pergunta->remover($pergunta_id)){
				//echo '<script>alert("Apagado com sucesso");location.href="gerenciar_perguntas.php";</script>';
				//echo 'foi';
				$assets = new assets();
				$assets->alert_sucesso("Apagado com sucesso");
				}else{
				$assets->alert_warning("Erro ao apagar");
				}
				}
				if(isset($_GET['acao']) && $_GET['acao'] == 'status'){

						}
					?>

					
						
					</tr>
				</table>				
				
				<?php if(isset($_POST['acao']) && $_POST['acao'] == 'enviar'){
					$quantidade = count($_POST['pergunta']);
					$i = 0;
					$pergunta = $_POST['pergunta'];
					if(empty($pergunta)){
						echo '<div class="isa_warning">O campo pergunta deve ser preenchido</div>';

					}else{
						$pdoVar = new PDO("mysql:host=$endereco;dbname=$banco", $usuario, $senha);
						$Perg = new Pergunta($pergunta, "1", $pdoVar);
						$inserção = $Perg->insere();
						if($inserção){
							$i++;
						}
						
						if($quantidade == $i){
							echo '<div class="isa_success">Pergunta cadastrada com sucesso.</div>';
						}else{
							echo '<div class="isa_error">Erro ao cadastrar pergunta.</div>';
						}	
					}
					

				}
				?>
			</div>	
		</div>
		
		
	</div>
</body>
</html>
